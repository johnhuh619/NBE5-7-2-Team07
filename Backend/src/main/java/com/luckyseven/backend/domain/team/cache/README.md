 # 팀 대시보드 성능 최적화 전략 (Caffeine 기반)

## 지출-기반 캐싱 구조

### 주요 특징

- **Write-through(쓰기-즉시) 캐싱 구조**로 대시보드 최적화
- 지출 변경 이벤트 발생 시점에 집계 쿼리 실행 및 캐시 갱신
- 대시보드 조회 시에는 항상 캐시된 값만 반환
- **인메모리 Caffeine 캐시** 사용으로 외부 의존성 제거 및 초고속 응답 보장

### Caffeine 캐시 사용 이점

1. **초고속 인메모리 성능**: Redis보다 훨씬 빠른 로컬 메모리 기반 응답 시간
2. **외부 서비스 의존성 제거**: 별도 Redis 서버 필요 없음
3. **스마트한 캐시 정책**: 사용 패턴에 따른 최적화된 항목 제거
4. **설정 간소화**: 추가 인프라 없이 간단하게 통합
5. **효율적인 메모리 관리**: 최대 항목 수 제한 및 자동 만료
6. **쉬운 적용**: 아주 쉽게 적용 가능

### 핵심 이점

1. **DB 부하 최소화**: 조회 요청이 몰려도 DB 부하 없음
2. **데이터 신선도 유지**: 지출 변경 시점에 즉시 캐시 갱신
3. **응답 시간 개선**: 복잡한 집계 쿼리를 매번 실행하지 않음

### 실제 사용 패턴 반영

- 유저는 대시보드로 진입하며 조회. 
- "지출을 등록한 뒤" 대시보드의 데이터 갱신 필요. "지출 등록 전" 에는 갱신이 필요 없다.
- "지출 등록~다음 지출까지"의 조회는 변경 없는 데이터를 반복 조회
- 대시보드 데이터를 캐싱해서 반복 조회 예방

### 구현 요소

1. `TeamDashboardCacheService`: Caffeine 기반 대시보드 캐싱 관리 서비스
2. `TeamService.refreshTeamDashboard()`: 지출 변경 시 호출되어 대시보드 갱신
3. `ExpenseService`: 지출 등록/수정/삭제 시 `refreshTeamDashboard()` 호출
4. 2,3은 변경 예정. 

### 최적화 효과(예상)

- 10명의 팀원이 하루 20회씩 조회해도 집계 쿼리는 지출 변경 시에만 발생 (하루 약 20회)
- 실제 DB 쿼리 부하: 400회 → 20회 (95% 감소)
- 응답 시간: ~200ms → ~2ms (99% 감소)

### 캐시 설정

- 최대 항목 수: 1,000개 (동시에 캐시할 수 있는 팀 대시보드 수)
- 마지막 접근 후 3시간 뒤 만료 (사용 빈도가 낮은 팀 데이터는 자동 제거)
- 메모리 사용량: 약 100MB (1,000개 팀 기준, 각 대시보드 평균 100KB 가정)
